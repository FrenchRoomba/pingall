urls = {
    "faas.alicloud": {
        "ap-northeast-1": "https://pinger-ast-bbcc-fs-pingst-badfa-mhhaziruml.ap-northeast-1.fcapp.run",
        "ap-south-1": "https://pinger-outh-bde-fs-pingouth-daa-pmomjfmpxa.ap-south-1.fcapp.run",
        "ap-southeast-1": "https://pinger-east-ebf-fs-pingeast-cec-xhryyfqdnh.ap-southeast-1.fcapp.run",
        "ap-southeast-2": "https://pinger-east-bdd-fs-pingeast-eab-ogyzvhmumo.ap-southeast-2.fcapp.run",
        "ap-southeast-3": "https://pinger-theast-e-fs-pingheast-ca-revylkwdhi.ap-southeast-3.fcapp.run",
        "ap-southeast-5": "https://pinger-east-bdf-fs-pingtheast-c-tgyzudqdmn.ap-southeast-5.fcapp.run",
        "cn-chengdu": "https://pinger-ngdu-ebf-fs-pinggdu-afac-vjnvikcfbn.cn-chengdu.fcapp.run",
        "cn-hangzhou": "https://pinger-ngzhou-f-fs-pinggzhou-ed-lckcbzrofy.cn-hangzhou.fcapp.run",
        "cn-hongkong": "https://pinger-kong-cfc-fs-pingng-cecdb-nxparfvrke.cn-hongkong.fcapp.run",
        "cn-huhehaote": "https://pinger-uhehaote-fs-pinghaote-da-bmkwjxtxba.cn-huhehaote.fcapp.run",
        "eu-central-1": "https://pinger-tral-aaf-fs-pingtral-fcd-uyxmmqlagu.eu-central-1.fcapp.run",
        "eu-west-1": "https://pinger-u-west-e-fs-pingu-west-b-ofckwqfekw.eu-west-1.fcapp.run",
        "us-east-1": "https://pinger-east-ffa-fs-ping-east-dd-gotmomzojx.us-east-1.fcapp.run",
        "us-west-1": "https://pinger-west-efd-fs-pingest-bcfe-nkhjspyofi.us-west-1.fcapp.run",
    },
    "faas.aws": {
        "af-south-1": "https://jbhkc7vh3ksra6duym6ibokr6q0dcgli.lambda-url.af-south-1.on.aws/",
        "ap-east-1": "https://xy7ubwvzm34an426b3n63jjsoe0hpajo.lambda-url.ap-east-1.on.aws/",
        "ap-northeast-1": "https://dwsj77pjptb4g5nltbx7use4hy0ngtff.lambda-url.ap-northeast-1.on.aws/",
        "ap-northeast-2": "https://odiwxohbrdajdclhxgmphdr7z40fhhlt.lambda-url.ap-northeast-2.on.aws/",
        "ap-northeast-3": "https://czesc4qw4ijzro6boa6wncpd7q0dwfne.lambda-url.ap-northeast-3.on.aws/",
        "ap-south-1": "https://tnrou22vgkb2iighz4kjlbsbca0jblct.lambda-url.ap-south-1.on.aws/",
        "ap-south-2": "https://kvj0fqsmvf.execute-api.ap-south-2.amazonaws.com/test",
        "ap-southeast-1": "https://ldukjanz3vfx4pmmrt7gmjcjmm0awzpt.lambda-url.ap-southeast-1.on.aws/",
        "ap-southeast-2": "https://2yctgz4v3mh7bt2asysjhjfv7a0mggqj.lambda-url.ap-southeast-2.on.aws/",
        "ap-southeast-3": "https://n2x46xzqf4qwitwq7blpc6svyi0ngwjg.lambda-url.ap-southeast-3.on.aws/",
        "ap-southeast-4": "https://cdq28iapxk.execute-api.ap-southeast-4.amazonaws.com/test",
        "ca-central-1": "https://q4tzuzvqwg33sslcljztwcuci40mnthg.lambda-url.ca-central-1.on.aws/",
        "ca-west-1": "https://av0ie7vqj0.execute-api.ca-west-1.amazonaws.com/test",
        "eu-central-1": "https://pzgpiaaostttyzggob2xlkfxia0oeydf.lambda-url.eu-central-1.on.aws/",
        "eu-central-2": "https://pwpi3pb163.execute-api.eu-central-2.amazonaws.com/test",
        "eu-north-1": "https://qyvdp3nrss3zutz2rhh7a757hq0bbfos.lambda-url.eu-north-1.on.aws/",
        "eu-south-1": "https://3xgtd4iwyokrkzhcw6iilgmx7i0txykn.lambda-url.eu-south-1.on.aws/",
        "eu-south-2": "https://u8garr6003.execute-api.eu-south-2.amazonaws.com/test",
        "eu-west-1": "https://e7dsclgpjfaaqpcigls5nkund40kviuq.lambda-url.eu-west-1.on.aws/",
        "eu-west-2": "https://dovyqxv7obq3uaax6ojpsabs4m0nqrcy.lambda-url.eu-west-2.on.aws/",
        "eu-west-3": "https://o5wfqnfkl7hkbd7yjslhqljcpq0iubxb.lambda-url.eu-west-3.on.aws/",
        "il-central-1": "https://1boen4mzfj.execute-api.il-central-1.amazonaws.com/test",
        "me-central-1": "https://7xp6yh8db5.execute-api.me-central-1.amazonaws.com/test",
        "me-south-1": "https://w2ek4bpxulmj5b3amiv23az7re0lzbdn.lambda-url.me-south-1.on.aws/",
        "sa-east-1": "https://ipqksn5hujq5eellqhowlb6key0gqpgi.lambda-url.sa-east-1.on.aws/",
        "us-east-1": "https://vb4v6wgj77pnk7cde3qvmbtp5m0mfjsw.lambda-url.us-east-1.on.aws/",
        "us-east-2": "https://ha535bzbprjcpzn7evz4iaieoq0gnjpe.lambda-url.us-east-2.on.aws/",
        "us-west-1": "https://ox5djcefi7bvgqnkzaaf4qnfg40sxezo.lambda-url.us-west-1.on.aws/",
        "us-west-2": "https://ysblhhbk7outvnmb2fz5mr5w3q0aidcg.lambda-url.us-west-2.on.aws/",
    },
    "faas.azure": {
        "australiaeast": "https://ping-australiaeast1630ca1b.azurewebsites.net/api/pinger",
        "australiasoutheast": "https://ping-australiasoutheast28f82d51.azurewebsites.net/api/pinger",
        "brazilsouth": "https://ping-brazilsouth6ef4a193.azurewebsites.net/api/pinger",
        "canadacentral": "https://ping-canadacentral1b6ae6ef.azurewebsites.net/api/pinger",
        "canadaeast": "https://ping-canadaeast6cb20218.azurewebsites.net/api/pinger",
        "centralindia": "https://ping-centralindia22f8d4c4.azurewebsites.net/api/pinger",
        "centralus": "https://ping-centralus17c6f98d.azurewebsites.net/api/pinger",
        "eastasia": "https://ping-eastasia8522cffd.azurewebsites.net/api/pinger",
        "eastus": "https://ping-eastusdc7499c4.azurewebsites.net/api/pinger",
        "eastus2": "https://ping-eastus2a56cad9c.azurewebsites.net/api/pinger",
        "francecentral": "https://ping-francecentral7538ae48.azurewebsites.net/api/pinger",
        "germanywestcentral": "https://ping-germanywestcentral2859aca2.azurewebsites.net/api/pinger",
        "japaneast": "https://ping-japaneast6956fb4a.azurewebsites.net/api/pinger",
        "japanwest": "https://ping-japanwestefc38bc6.azurewebsites.net/api/pinger",
        "koreacentral": "https://ping-koreacentralbccc225e.azurewebsites.net/api/pinger",
        "northcentralus": "https://ping-northcentralus277fdc78.azurewebsites.net/api/pinger",
        "northeurope": "https://ping-northeurope5589f031.azurewebsites.net/api/pinger",
        "norwayeast": "https://ping-norwayeaste7753f5b.azurewebsites.net/api/pinger",
        "southafricanorth": "https://ping-southafricanorth910fc421.azurewebsites.net/api/pinger",
        "southcentralus": "https://ping-southcentralus337503a5.azurewebsites.net/api/pinger",
        "southeastasia": "https://ping-southeastasia87e3468e.azurewebsites.net/api/pinger",
        "southindia": "https://ping-southindia03ef0264.azurewebsites.net/api/pinger",
        "swedencentral": "https://ping-swedencentral00d5dabb.azurewebsites.net/api/pinger",
        "switzerlandnorth": "https://ping-switzerlandnorth2765df8a.azurewebsites.net/api/pinger",
        "uaenorth": "https://ping-uaenorthf0c25e56.azurewebsites.net/api/pinger",
        "uksouth": "https://ping-uksouth598d1349.azurewebsites.net/api/pinger",
        "ukwest": "https://ping-ukwestc96fd740.azurewebsites.net/api/pinger",
        "westcentralus": "https://ping-westcentralusc8a0631e.azurewebsites.net/api/pinger",
        "westeurope": "https://ping-westeurope312c5f52.azurewebsites.net/api/pinger",
        "westindia": "https://ping-westindia2f7cae61.azurewebsites.net/api/pinger",
        "westus": "https://ping-westus735d8b10.azurewebsites.net/api/pinger",
        "westus2": "https://ping-westus292e61f82.azurewebsites.net/api/pinger",
    },
    "faas.gcp": {
        "africa-south1": "https://ping-africa-south1-tx45f4bnfa-bq.a.run.app",
        "asia-east1": "https://ping-asia-east1-tx45f4bnfa-de.a.run.app",
        "asia-east2": "https://ping-asia-east2-tx45f4bnfa-df.a.run.app",
        "asia-northeast1": "https://ping-asia-northeast1-tx45f4bnfa-an.a.run.app",
        "asia-northeast2": "https://ping-asia-northeast2-tx45f4bnfa-dt.a.run.app",
        "asia-northeast3": "https://ping-asia-northeast3-tx45f4bnfa-du.a.run.app",
        "asia-south1": "https://ping-asia-south1-tx45f4bnfa-el.a.run.app",
        "asia-south2": "https://ping-asia-south2-tx45f4bnfa-em.a.run.app",
        "asia-southeast1": "https://ping-asia-southeast1-tx45f4bnfa-as.a.run.app",
        "asia-southeast2": "https://ping-asia-southeast2-tx45f4bnfa-et.a.run.app",
        "australia-southeast1": "https://ping-australia-southeast1-tx45f4bnfa-ts.a.run.app",
        "australia-southeast2": "https://ping-australia-southeast2-tx45f4bnfa-km.a.run.app",
        "europe-central2": "https://ping-europe-central2-tx45f4bnfa-lm.a.run.app",
        "europe-north1": "https://ping-europe-north1-tx45f4bnfa-lz.a.run.app",
        "europe-southwest1": "https://ping-europe-southwest1-tx45f4bnfa-no.a.run.app",
        "europe-west1": "https://ping-europe-west1-tx45f4bnfa-ew.a.run.app",
        "europe-west10": "https://ping-europe-west10-tx45f4bnfa-oe.a.run.app",
        "europe-west12": "https://ping-europe-west12-tx45f4bnfa-og.a.run.app",
        "europe-west2": "https://ping-europe-west2-tx45f4bnfa-nw.a.run.app",
        "europe-west3": "https://ping-europe-west3-tx45f4bnfa-ey.a.run.app",
        "europe-west4": "https://ping-europe-west4-tx45f4bnfa-ez.a.run.app",
        "europe-west6": "https://ping-europe-west6-tx45f4bnfa-oa.a.run.app",
        "europe-west8": "https://ping-europe-west8-tx45f4bnfa-oc.a.run.app",
        "europe-west9": "https://ping-europe-west9-tx45f4bnfa-od.a.run.app",
        "me-central1": "https://ping-me-central1-tx45f4bnfa-ww.a.run.app",
        "me-west1": "https://ping-me-west1-tx45f4bnfa-zf.a.run.app",
        "northamerica-northeast1": "https://ping-northamerica-northeast1-tx45f4bnfa-nn.a.run.app",
        "northamerica-northeast2": "https://ping-northamerica-northeast2-tx45f4bnfa-pd.a.run.app",
        "southamerica-east1": "https://ping-southamerica-east1-tx45f4bnfa-rj.a.run.app",
        "southamerica-west1": "https://ping-southamerica-west1-tx45f4bnfa-tl.a.run.app",
        "us-central1": "https://ping-us-central1-tx45f4bnfa-uc.a.run.app",
        "us-east1": "https://ping-us-east1-tx45f4bnfa-ue.a.run.app",
        "us-east4": "https://ping-us-east4-tx45f4bnfa-uk.a.run.app",
        "us-east5": "https://ping-us-east5-tx45f4bnfa-ul.a.run.app",
        "us-south1": "https://ping-us-south1-tx45f4bnfa-vp.a.run.app",
        "us-west1": "https://ping-us-west1-tx45f4bnfa-uw.a.run.app",
        "us-west2": "https://ping-us-west2-tx45f4bnfa-wl.a.run.app",
        "us-west3": "https://ping-us-west3-tx45f4bnfa-wm.a.run.app",
        "us-west4": "https://ping-us-west4-tx45f4bnfa-wn.a.run.app",
    },
}


from fastapi import FastAPI
import aiohttp
import asyncio


app = FastAPI()


@app.get("/")
async def root(url):
    async with aiohttp.ClientSession() as session:
        tasks = []
        results = {}
        for provider, regions in urls.items():
            results[provider] = {}
            for region, uurl in regions.items():
                task = asyncio.create_task(session.get(f"{uurl}?url={url}"))
                print(task)
                tasks.append(task)
                results[provider][region] = task
        await asyncio.gather(*tasks)
        results_list = []
        errors = []
        for provider, regions in results.items():
            for region, task in regions.items():
                response = task.result()
                if response.ok:
                    results_list.append(
                        {
                            "region": f"{provider}.{region}",
                            "time": await response.text(),
                        }
                    )
                errors.append(
                    {
                        "region": f"{provider}.{region}",
                        "status_code": response.status,
                        "body": await response.text(),
                    }
                )
    print(results_list)

    def sort(a):
        try:
            return float(a["time"])
        except:
            return -1

    results_list.sort(key=sort)
    # results_list.sort(key=lambda a: a["time"])
    return {"results": results_list, "errors": errors}


@app.get("/liveness_check")
async def liveness_check():
    return "Ok!"


@app.get("/readiness_check")
async def readiness_check():
    return "Ok!"
